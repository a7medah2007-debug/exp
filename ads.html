<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite Rewards | ÙƒØ³Ø¨ Ø§Ù„Ù…ÙƒØ§ÙØ¢Øª</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <style>
        :root { --neon: #00d2ff; --bg: #050a15; --card-bg: rgba(255, 255, 255, 0.05); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; padding: 15px; }
        .card { background: var(--card-bg); border: 1px solid var(--neon); padding: 25px 20px; border-radius: 20px; text-align: center; width: 100%; max-width: 400px; box-shadow: 0 0 20px rgba(0, 210, 255, 0.1); backdrop-filter: blur(10px); }
        #balance { font-size: 2.8rem; font-weight: 900; color: var(--neon); text-shadow: 0 0 10px var(--neon); margin: 10px 0; }
        .ad-viewport { width: 100%; min-height: 250px; background: #000; border-radius: 12px; margin: 20px 0; border: 1px solid #1e293b; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
        #timer-overlay { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.8); padding: 5px 12px; border-radius: 20px; color: var(--neon); font-size: 0.8rem; border: 1px solid var(--neon); display: none; z-index: 10; }
        button { width: 100%; padding: 16px; border-radius: 12px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; font-size: 1rem; }
        #startBtn { background: transparent; border: 2px solid var(--neon); color: var(--neon); margin-bottom: 10px; }
        #startBtn:disabled { border-color: #333; color: #555; cursor: not-allowed; }
        #rewardBtn { background: var(--neon); color: #000; display: none; }
        #backBtn { background: rgba(255, 255, 255, 0.05); color: #ccc; margin-top: 10px; }
        #msg { margin-top: 15px; font-size: 0.9rem; color: var(--neon); min-height: 40px; }
        .loader { border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid var(--neon); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="card">
        <div style="font-size: 0.75rem; opacity: 0.6;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©</div>
        <div id="balance">0.00</div>
        
        <div class="ad-viewport" id="adContainer">
            <div id="timer-overlay">30s</div>
            <div id="ad-slot">
                <p style="color:#4a5568; font-size:0.8rem;">Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª...</p>
            </div>
        </div>

        <button id="startBtn" onclick="runVideoProcess()">Ø¨Ø¯Ø¡ Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
        <button id="rewardBtn" onclick="collectReward()">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ø§Ù„Ø¢Ù†</button>
        <button id="backBtn" onclick="window.location.href='index.html'">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>

        <div id="msg">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
        
        <div style="margin-top: 20px; font-size: 0.75rem; opacity: 0.5; display: flex; justify-content: space-between; width: 100%;">
            <span>Ø§Ù„Ù…Ù‡Ù…Ø§Øª: <b id="dailyCount">0 / 15</b></span>
            <span>Ø§Ù„Ø­Ø§Ù„Ø©: <b id="userStatus">Ù…ØªØµÙ„</b></span>
        </div>
    </div>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyBKXxVqGiL0Ml_kEeNzchzHUMYPsFyl-jM",
    authDomain: "rewardsite-9025d.firebaseapp.com",
    projectId: "rewardsite-9025d",
    storageBucket: "rewardsite-9025d.firebasestorage.app",
    messagingSenderId: "777911247728",
    appId: "1:777911247728:web:089c8f41a1684c35d7a5b5"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let userUID = null;
let isLocked = false; 

const DIRECT_LINKS = [
    "https://ballisticcomainvitation.com/k0eagxazc?key=003f66bbb890eceef1381c08b579649f", 
    "https://otieu.com/4/10586232",
    "https://shrinkme.click/expreward", 
    "https://shrinkme.click/iskekd", 
    "https://shrinkme.click/otakuarab", 
    "https://tpi.li/exprewsrd", 
    "https://tpi.li/iskekd", 
    "https://tpi.li/otakuarab", 
    
];

function displayRandomBanner() {
    const slot = document.getElementById('ad-slot');
    if(!slot) return;

    const fallbackAd = `<a href="${DIRECT_LINKS[0]}" target="_blank" style="text-decoration:none;">
        <div style="width:300px; height:250px; background:linear-gradient(45deg, #050a15, #1e293b); border:1px solid #00d2ff; border-radius:10px; display:flex; align-items:center; justify-content:center; flex-direction:column; cursor:pointer;">
            <div style="font-size:2rem; margin-bottom:10px;">ğŸ</div>
            <p style="color:white; font-size:0.8rem;">Ø§Ø¶ØºØ· ÙˆØ§Ù†ØªØ¸Ø± 10 Ø«ÙˆØ§Ù†ÙŠ Ù„ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªØ³Ø§Ø¨</p>
        </div>
    </a>`;

    const randomChoice = Math.random();
    slot.innerHTML = ""; 

    try {
        if (randomChoice < 0.4) {
            // Adsterra - Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠØ© Ø§Ù„Ù…Ø¹Ø¯Ù„Ø©
            const script1 = document.createElement('script');
            script1.type = 'text/javascript';
            script1.text = `atOptions = { 'key' : 'bd100f5de33bb8359ef151eb1e7eecef', 'format' : 'iframe', 'height' : 250, 'width' : 300, 'params' : {} };`;
            const script2 = document.createElement('script');
            script2.type = 'text/javascript';
            script2.src = 'https://www.highperformanceformat.com/invoke.js';
            slot.appendChild(script1);
            slot.appendChild(script2);
        } else if (randomChoice < 0.8) {
            // Monetag
            const mDiv = document.createElement('div');
            mDiv.id = "monetag-ad-inner";
            slot.appendChild(mDiv);
            const mScript = document.createElement('script');
            mScript.src = 'https://nap5k.com/tag.min.js';
            mScript.setAttribute('data-zone', '10586190');
            mScript.async = true;
            slot.appendChild(mScript);
        } else {
            slot.innerHTML = fallbackAd;
        }
    } catch (e) {
        slot.innerHTML = fallbackAd;
    }

    setTimeout(() => {
        if (slot.innerHTML === "" || slot.offsetHeight < 20) {
            slot.innerHTML = fallbackAd;
        }
    }, 4000);
}

auth.onAuthStateChanged(user => {
    if (user) { 
        userUID = user.uid; 
        startSync(); 
        setTimeout(displayRandomBanner, 1000); 
    } else {
        document.getElementById('msg').innerText = "ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹";
    }
});

function startSync() {
    if(!userUID) return;
    db.collection("users").doc(userUID).onSnapshot(doc => {
        if (!doc.exists || isLocked) return;
        const data = doc.data();
        document.getElementById('balance').innerText = (data.balance || 0).toFixed(2);
        document.getElementById('dailyCount').innerText = `${data.videosWatchedToday || 0} / 15`;
        if (data.videosWatchedToday >= 15) { updateUI("Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù…Ø§Øª Ø§Ù„ÙŠÙˆÙ…!", true); }
        else { updateUI("Ø¬Ø§Ù‡Ø² Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©", false); }
    });
}

function runVideoProcess() {
    isLocked = true; 
    document.getElementById('startBtn').disabled = true;
    const timerOverlay = document.getElementById('timer-overlay');
    timerOverlay.style.display = 'block';
    let timeLeft = 30; 
    updateUI("â³ Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø·..", true);
    const countdown = setInterval(() => {
        timerOverlay.innerText = timeLeft + "s";
        timeLeft--;
        if (timeLeft < 0) {
            clearInterval(countdown);
            timerOverlay.style.background = "#22c55e";
            timerOverlay.innerText = "Ø¬Ø§Ù‡Ø²!";
            document.getElementById('rewardBtn').style.display = 'block';
            updateUI("âœ… Ø§Ø¶ØºØ· Ø¨Ø§Ù„Ø£Ø³ÙÙ„ Ù„Ù„Ù…Ø·Ø§Ù„Ø¨Ø©", true);
        }
    }, 1000);
}

async function collectReward() {
    if (!userUID) return;
    const chosenLink = DIRECT_LINKS[Math.floor(Math.random() * DIRECT_LINKS.length)];
    window.open(chosenLink, '_blank'); 
    document.getElementById('rewardBtn').style.display = 'none';
    let waitTime = 10;
    const timerInterval = setInterval(async () => {
        updateUI(`<div class="loader"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚.. Ø§Ù†ØªØ¸Ø± ${waitTime} Ø«Ø§Ù†ÙŠØ©`, true);
        waitTime--;
        if (waitTime < 0) {
            clearInterval(timerInterval);
            await savePoints();
        }
    }, 1000);
}

async function savePoints() {
    updateUI('<div class="loader"></div> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...', true);
    try {
        await db.collection("users").doc(userUID).update({
            balance: firebase.firestore.FieldValue.increment(1.0),
            videosWatchedToday: firebase.firestore.FieldValue.increment(1),
            lastAdTime: firebase.firestore.FieldValue.serverTimestamp()
        });
        updateUI("âœ… ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©!", false);
        setTimeout(() => { location.reload(); }, 1000);
    } catch(e) {
        updateUI("âŒ Ø®Ø·Ø£ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹", false);
        document.getElementById('rewardBtn').style.display = 'block';
    }
}

function updateUI(text, btnState) {
    document.getElementById('msg').innerHTML = text;
    document.getElementById('startBtn').disabled = btnState;
}
</script>
</body>
</html>
